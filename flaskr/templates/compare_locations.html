{% extends 'default.html' %}
{% set title = "Choys - main" %}

{% block content %}
    <div id='sorters' class="field is-grouped">
        <button id='name_btn' class='sort_btn button' data-sort='0' {# onclick="sortTable(0)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Location
            </span>
        </button>
        <button id='total_properties_btn' class='sort_btn button' data-sort='1' {# onclick="sortTable(1)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Number of Properties
            </span>
        </button>
        <button id='average_rent_btn' class='sort_btn button' data-sort='2' {# onclick="sortTable(2)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Average Rent (&#163; / pcm)
            </span>
        </button>
        <button id='rent_under_250_btn' class='sort_btn button' data-sort='3' {# onclick="sortTable(3)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Number of properties under &#163;250 pcm
            </span>
        </button>
        <button id='rent_250_to_500_btn' class='sort_btn button' data-sort='4' {# onclick="sortTable(4)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Number of properties between &#163;250 and &#163;500 pcm
            </span>
        </button>
        <button id='distance_to_london' class='sort_btn button' data-sort='5' {# onclick="sortTable(5)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Distance to London
            </span>
        </button>
        <button id='duration_to_london' class='sort_btn button' data-sort='6' {# onclick="sortTable(6)" #}>
            <span class="icon">
                <i class="fas fa-chevron-right"></i>
            </span>
            <span>
                Duration to London
            </span>
        </button>
        <button id='score' class='sort_btn button is-selected is-primary' data-sort='7' {# onclick="sortTable(7)" #}>
            <span class="icon">
                <i class="fas fa-chevron-down"></i>
            </span>
            <span>
                Score
            </span>
        </button>
    </div>
    <table id='compare_table' class="box table">
        <thead>
            <tr>
                <th>
                    Location
                </th>
                <th>
                    Number of Properties
                </th>
                <th>
                    Average Rent (&#163; / pcm)
                </th>
                <th>
                    Number of properties under &#163;250 pcm
                </th>
                <th>
                    Number of properties between &#163;250 and &#163;500 pcm
                </th>
                <th>
                    Distance to London
                </th>
                <th>
                    Duration to London
                </th>
                <th>
                    Score
                </th>
            </tr>
        </thead>
        <tbody>
            {% for row in location_array|sort(attribute='score', reverse=True) %}
                {% if row.total_properties > 0 %}
                    <tr>
                        {% set row_data = [
                            {'data_value': row.name, 'content': '<strong>' + row.name + '</strong>'},
                            {'data_value': row.total_properties, 'content': row.total_properties},
                            {'data_value': row.average_rent, 'content': row.average_rent},
                            {'data_value': row.rent_under_250, 'content': row.rent_under_250},
                            {'data_value': row.rent_250_to_500, 'content': row.rent_250_to_500},
                            {'data_value': row.distance_to_london, 'content': row.distance_to_london},
                            {'data_value': row.duration_to_london, 'content': row.duration_to_london},
                            {'data_value': row.score, 'content': row.score},
                        ] %}
                        {% for cell in row_data %}
                            <td data-value="{{ cell['data_value'] }}">
                                {{ cell['content']|safe }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>

    <div id='compare_cards' class="box is-vertical">
        <div id="cards" class="tile is-ancestor is-vertical">
            <div class="tile is-parent">
                {% for row in location_array|sort(attribute='score', reverse=True) %}
                    <div class="tile is-child notification is-{{ loop.cycle('link', 'success', 'primary', 'warning', 'danger', 'dark') }} has-text-centered">
                        <div class="title" data-value="{{ row.name }}">
                            {{ row.name }}
                        </div>

                        <div data-value="{{ row.total_properties }}">
                            <strong>{{ row.total_properties }}</strong>
                            {% if row.total_properties == 1 %}
                                property
                            {% else %}
                                properties
                            {% endif %}
                        </div>

                        <div data-value="{{ row.average_rent }}">
                            Average rent is <strong>£{{ row.average_rent }}</strong>
                        </div>

                        <div data-value="{{ row.rent_under_250 }}">
                            <strong>{{ row.rent_under_250 }}</strong>
                            {% if row.rent_under_250 == 1 %}
                                property
                            {% else %}
                                properties
                            {% endif %}
                            under £250
                        </div>

                        <div data-value="{{ row.rent_250_to_500 }}">
                            <strong>{{ row.rent_250_to_500 }}</strong>
                            {% if row.rent_250_to_500 == 1 %}
                                property
                            {% else %}
                                properties
                            {% endif %}
                            between £250 and £500
                        </div>

                        <div data-value="{{ row.distance_to_london }}">
                            <strong>{{ row.distance_to_london_text }}</strong> to London
                        </div>

                        <div data-value="{{ row.duration_to_london }}">
                            <strong>{{ row.duration_to_london_text }}</strong> to London
                        </div>

                        <div class="notification is-light" data-value="{{ row.score }}">
                            Score:&nbsp;<strong>{{ row.score|round(3) }}</strong>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block navbar_end_add %}
    <a class="button is-danger" id="table-cards-btn">
        <span class="icon">
            <i class="far fa-list-alt"></i>
        </span>
    </a>
{% endblock %}
